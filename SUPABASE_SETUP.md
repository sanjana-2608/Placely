# Supabase Setup (Phase 1)

This project now supports Supabase for the `students` data path.

## 1) Create a Supabase project

1. Go to https://supabase.com and create/open your project.
2. Open **Project Settings â†’ API**.
3. Copy:
   - `Project URL`
   - `service_role` key (server-side only)

For this project, your URL is:

- `https://nwtluvxaurtpvuityoyl.supabase.co`

## 2) Create the `students` table

Run this SQL in **SQL Editor**:

```sql
create table if not exists public.students (
  id bigint primary key generated by default as identity,
  name text not null,
  email text not null unique,
  leetcode_username text,
  coding_problems integer not null default 0,
  internships integer not null default 0,
  certifications integer not null default 0,
  grade_points numeric(4,2) not null default 0,
  year integer not null default 1,
  interest text not null default 'Interested',
  dept text not null default 'CSE',
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);

create or replace function public.set_updated_at()
returns trigger as $$
begin
  new.updated_at = now();
  return new;
end;
$$ language plpgsql;

drop trigger if exists trg_students_updated_at on public.students;
create trigger trg_students_updated_at
before update on public.students
for each row execute function public.set_updated_at();
```

## 3) Add real student data (optional)

You can insert students manually via SQL Editor or use the app's staff interface after login.

## 4) Set environment variables

Set these in local shell and Railway:

- `SUPABASE_URL=<your_project_url>`
- `SUPABASE_SERVICE_ROLE_KEY=<your_service_role_key>`

If your Supabase UI only shows newer key labels, this app also accepts:

- `SUPABASE_KEY`
- `SUPABASE_SECRET_KEY`
- `SUPABASE_ANON_KEY`
- `SUPABASE_PUBLISHABLE_KEY`

## 5) Install dependencies and run

```bash
pip install -r requirements.txt
python app.py
```

## Current behavior

- If Supabase is configured, `/api/students`, login lookup, student update, LeetCode batch student list, and year analytics read from Supabase.
- If Supabase is not configured, the app falls back to in-memory demo data.

This allows safe incremental migration to DB-backed data.
